
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>宿屋リンクまとめ - Step 1.1</title>
  <style>
    body { margin: 0; background: #222; }
    canvas { display: block; margin: auto; }
  </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
<script>
  const config = {
    type: Phaser.AUTO,
    width: 512,
    height: 320,
    pixelArt: true,
    physics: {
      default: 'arcade',
      arcade: { gravity: { y: 0 }, debug: false }
    },
    scene: { preload, create, update }
  };

  const game = new Phaser.Game(config);
  let player, cursors, map, tileset, layer;

  function preload() {
    this.load.image('tiles', 'tiles.png');
    this.load.spritesheet('ghost', 'ghost.png', { frameWidth: 32, frameHeight: 32 });
  }

  function create() {
    map = this.make.tilemap({ width: 16, height: 10, tileWidth: 32, tileHeight: 32 });
    tileset = map.addTilesetImage('tiles');
    layer = map.createBlankLayer('layer1', tileset);

    // 宿屋マップの床（tile index 0）と壁（tile index 1）を仮に配置
    for (let y = 0; y < 10; y++) {
      for (let x = 0; x < 16; x++) {
        let index = (y === 0 || y === 9 || x === 0 || x === 15) ? 1 : 0;
        map.putTileAt(index, x, y, false, 'layer1');
      }
    }
    layer.setCollision(1);

    player = this.physics.add.sprite(32 * 2, 32 * 8, 'ghost', 0);
    player.setCollideWorldBounds(true);
    this.physics.add.collider(player, layer);

    this.anims.create({
      key: 'walk',
      frames: this.anims.generateFrameNumbers('ghost', { start: 0, end: 3 }),
      frameRate: 6,
      repeat: -1
    });

    cursors = this.input.keyboard.createCursorKeys();
  }

  function update() {
    player.setVelocity(0);
    if (cursors.left.isDown) {
      player.setVelocityX(-100);
      player.anims.play('walk', true);
    } else if (cursors.right.isDown) {
      player.setVelocityX(100);
      player.anims.play('walk', true);
    } else if (cursors.up.isDown) {
      player.setVelocityY(-100);
      player.anims.play('walk', true);
    } else if (cursors.down.isDown) {
      player.setVelocityY(100);
      player.anims.play('walk', true);
    } else {
      player.anims.stop();
    }
  }
</script>
</body>
</html>
